<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mount Aetheria - Story</title>
<link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:Arial,sans-serif;background:linear-gradient(to bottom,#222,#444);display:flex;height:100vh;overflow:hidden}
.top-nav{width:100%;background:#111;padding:15px 20px;display:flex;justify-content:space-around;align-items:center;position:fixed;top:0;left:0;z-index:2000}
.top-nav a{color:#fff;text-decoration:none;font-size:18px;font-weight:600;font-family:'Uncial Antiqua',serif}
.top-nav a:hover{color:#ffcc66}
.sidebar{width:200px;background:#111;padding-top:120px;display:flex;flex-direction:column;gap:10px;overflow-y:auto}
.sidebar h3{color:#ffcc66;text-align:center;margin:10px 0}
.sidebar button{background:#333;color:#fff;border:none;padding:10px;cursor:pointer;border-radius:8px;width:90%;margin:5px auto;text-align:left;font-weight:bold}
.sidebar button:hover,.sidebar button.active{background:#ffcc66;color:#111}
.main-content{flex:1;overflow-y:auto;padding:120px 20px 20px 20px}
.small-img{width:150px;height:auto;border-radius:5px;object-fit:cover}
.story-entry{background:#222;color:#fff;border-radius:12px;margin-bottom:15px;box-shadow:0 5px 15px rgba(0,0,0,0.5)}
.story-entry h3{margin:0;padding:15px;cursor:pointer;user-select:none;font-family:'Uncial Antiqua',serif}
.story-entry h4{padding:15px;text-align:center;display:none}
.story-entry .content{padding:15px;display:none}
.story-entry img{max-width:100%;border-radius:8px;margin-top:10px}
.story-entry .content.show{display:block;animation:fadeIn 0.3s ease-in-out}
.image-row{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:30px}
.image-row img:only-child{width:20%;height:auto}
.image-row img:not(:only-child){width:30%;height:200px}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
</style>
</head>
<body>

<!-- TOP NAV -->
<nav class="top-nav">
  <a href="index.html">Home</a>
  <a href="story.html">Story</a>
  <a href="tools.html">Tools</a>
  <a href="characters.html">Character Sheet</a>
  <a href="discussions.html">Discussion</a>
  <a href="account.html">My Account</a>
</nav>

<!-- LEFT SIDEBAR -->
<div class="sidebar">
  <h3>Stories</h3>
  <div class="primary-tags"></div>

  <h3>Character</h3>
  <div class="secondary-tags"></div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content" id="story-container"></div>

<script>
// Check for secret code in URL
const secretUnlocked = window.location.search.includes("code10");

// Default locked message
let lockedTitle = "Cannot attune";
let lockedDesc = "Your will is not strong enough to access this data.";

// ===== STORY DATA =====
const stories = [
  {primary:"dark-grasp", secondary:"kal'en", title:"Dark Grasp: Session 1", sections:[{subtitle:"Amidst of Dawn", text:"Two unknown adventurers—Astra and Onyx—begin their journey...", images:["Tools/Session 1/Amidst of Dawn.jpg","Tools/Session 1/Shrine Lake.jpg","Tools/Session 1/Merchant Market.jpg"]}]},
  {primary:"dark-grasp", secondary:"lira", title:"Dark Grasp: Session 2", sections:[{subtitle:"", text:"Lira sneaks into the castle to gather information...", images:["images/session2.jpg"]}]},
  {primary:"rean-legacy", secondary:"character-a", title:"Re'an Legacy: Chapter 1", sections:[{subtitle:"", text:"The legacy of Re'an begins with secrets unfolding in the ancient temple...", images:["images/rean1.jpg"]}]},
  {primary:"alissas-revenge", secondary:"alissa", title:"Alissa Revenge: Opening", sections:[{subtitle:"", text:"udduhy...", images:["images/Alissa1.jpg"]}]}
];

// ===== RENDER PRIMARY BUTTONS =====
const primaryContainer = document.querySelector(".primary-tags");

function renderPrimaryButtons() {
  primaryContainer.innerHTML = "";

  const baseButtons = [
    {label: "All", primary: "all"},
    {label: "Dark Grasp", primary: "dark-grasp"},
    {label: "Re'an Legacy", primary: "rean-legacy"}
  ];

  baseButtons.forEach(b => {
    const btn = document.createElement("button");
    btn.classList.add("primary-btn");
    if(b.primary === "all") btn.classList.add("active");
    btn.dataset.primary = b.primary;
    btn.textContent = b.label;
    primaryContainer.appendChild(btn);
  });

  if(secretUnlocked){
    const btn = document.createElement("button");
    btn.classList.add("primary-btn");
    btn.dataset.primary = "alissas-revenge";
    btn.textContent = "Alissa's Revenge";
    primaryContainer.appendChild(btn);
  } else {
    const btn = document.createElement("button");
    btn.classList.add("primary-btn");
    btn.dataset.primary = "???";
    btn.textContent = "???";
    primaryContainer.appendChild(btn);
  }

  document.querySelectorAll(".primary-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".primary-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      updateSecondaryButtons(btn.dataset.primary);
      filterStories();
    });
  });
}

// ===== RENDER STORIES =====
function renderStories(){
  const container = document.getElementById("story-container");
  container.innerHTML = "";
  stories.forEach(story=>{

    // Locked route behaviour
    if(story.primary === "alissas-revenge" && !secretUnlocked){
      const hiddenDiv = document.createElement("div");
      hiddenDiv.classList.add("story-entry");
      hiddenDiv.innerHTML = `<h3 style="color:red;">${lockedTitle}</h3>
        <div class="content"><p style="text-align:center;font-size:1.2em;color:#ffcc66;">${lockedDesc}</p></div>`;
      container.appendChild(hiddenDiv);
      return;
    }

    const entry = document.createElement("div");
    entry.classList.add("story-entry");
    entry.dataset.primary = story.primary;
    entry.dataset.char = story.secondary.toLowerCase().replace(/\s/g,"-");

    const h3 = document.createElement("h3");
    h3.textContent = story.title;
    entry.appendChild(h3);

    const content = document.createElement("div");
    content.classList.add("content");

    story.sections.forEach(sec=>{
      if(sec.subtitle){
        const h4 = document.createElement("h4");
        h4.textContent = sec.subtitle;
        content.appendChild(h4);
      }
      const p = document.createElement("p");
      p.innerHTML = sec.text;
      content.appendChild(p);

      if(sec.images.length){
        const row = document.createElement("div");
        row.classList.add("image-row");
        sec.images.forEach(img=>{
          const im = document.createElement("img");
          im.src = img;
          im.classList.add("small-img");
          row.appendChild(im);
        });
        content.appendChild(row);
      }
    });

    entry.appendChild(content);
    container.appendChild(entry);
  });
}

// ===== COLLAPSIBLE =====
document.addEventListener("click", e=>{
  if(e.target.matches(".story-entry h3")){
    const content = e.target.nextElementSibling;
    content.classList.toggle("show");
  }
});

// ===== SECONDARY BUTTONS =====
const secondaryContainer = document.querySelector(".secondary-tags");

const secondaryTags = {
  all: ["All"],
  "dark-grasp": ["All","Astra","Cherrisa","Onyx","Ravyn","NPC"],
  "rean-legacy": ["All","Eve","Alexio","NPC"],
  "alissas-revenge": ["All","Alissa","NPC"],
};

function updateSecondaryButtons(primaryTag){
  secondaryContainer.innerHTML="";
  (secondaryTags[primaryTag]||["All"]).forEach(tag=>{
    const btn = document.createElement("button");
    btn.classList.add("secondary-btn");
    btn.dataset.secondary = tag.toLowerCase().replace(/\s/g,"-");
    btn.textContent = tag;
    if(tag==="All") btn.classList.add("active");
    secondaryContainer.appendChild(btn);

    btn.addEventListener("click",()=>{
      document.querySelectorAll(".secondary-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      filterStories();
    });
  });
}

// ===== FILTER STORIES =====
function filterStories(){
  const activePrimary = document.querySelector(".primary-btn.active").dataset.primary;
  const activeSecondary = document.querySelector(".secondary-btn.active")?.dataset.secondary || "all";
  document.querySelectorAll(".story-entry").forEach(entry=>{
    const matchP = activePrimary==="all"||entry.dataset.primary===activePrimary;
    const matchS = activeSecondary==="all"||entry.dataset.char===activeSecondary;
    entry.style.display = matchP&&matchS?"block":"none";
  });
}

// ===== INIT =====
renderPrimaryButtons();
renderStories();
updateSecondaryButtons("all");
filterStories();
</script>

</body>
</html>
