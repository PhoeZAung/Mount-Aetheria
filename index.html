<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Maps - Mount Aetheria</title>
<link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:Arial,sans-serif;background:linear-gradient(#222,#444);display:flex;flex-direction:column;align-items:center;padding-top:70px;min-height:100vh}
.top-nav { width: 100%; background: #111; padding: 15px 20px; display: flex; justify-content: space-around; align-items: center; position: fixed; top: 0; left: 0; z-index: 2000; flex-wrap: wrap; }
.top-nav a { color: white; text-decoration: none; font-size: 18px; font-weight: 600; font-family: 'Uncial Antiqua', serif; margin: 0 10px; }
.top-nav a:hover, .top-nav a.active { color: #ffcc66; }
.map-title{font-family:'Uncial Antiqua',cursive;font-size:36px;color:#fff;text-align:center;margin:10px 0;text-shadow:2px 2px 6px #000}
.tabs{display:flex;flex-wrap:wrap;margin-bottom:5px;justify-content:center;gap:5px}
.tabs button{padding:6px 12px;background:#111;color:#fff;border:none;cursor:pointer;border-radius:6px;font-family:'Uncial Antiqua',serif;font-size:14px}
.tabs button.active{background:#ffcc66;color:#111;font-weight:bold}
.outer-frame{width:95vw;height:60vh;max-height:80vh;background:#222;border-radius:16px;display:flex;justify-content:center;align-items:center;position:relative;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.7)}
.tab-content{display:none;width:100%;height:100%;position:relative}
.tab-content.active{display:block}
.map-container{width:100%;height:100%;position:relative;cursor:grab}
.map{position:absolute;top:0;left:0;width:100%;height:100%;transform-origin:0 0}
.map img{width:100%;height:100%;display:block}
.pin{position:absolute;width:30px;height:30px;transform:translate(-50%,-50%);cursor:pointer;z-index:3}
.pin img{width:100%;height:100%;object-fit:contain}
.popup{position:absolute;background:#fff;border:1px solid #666;border-radius:12px;padding:12px 16px;width:220px;max-width:260px;text-align:center;display:none;z-index:5;box-shadow:0 5px 15px rgba(0,0,0,.5);color:#000}
.popup img{max-width:100%;max-height:120px;width:auto;height:auto;margin:0 auto 6px auto;display:block;border-radius:5px}
.popup h3{margin:5px 0;font-size:16px}
.popup p{margin:0;font-size:14px}
.legend{position:relative;margin:10px auto 30px auto;display:flex;flex-wrap:wrap;justify-content:center;gap:10px;background:#797878;border:1px solid #ccc;border-radius:10px;padding:8px;font-size:12px}
.legend-item{display:flex;align-items:center;gap:6px}
.legend-item img{width:40px;height:40px}
.mobile-tabs{display:none;position:relative;margin-bottom:10px}
.tab-menu{display:none;flex-direction:column;position:absolute;background:#111;border-radius:6px;padding:5px;top:100%;left:0;z-index:1000}
.tab-menu button{margin:2px 0;padding:8px 12px;color:#fff;background:#111;border:none;text-align:left;width:150px;cursor:pointer;border-bottom:1px solid #333;font-family:'Uncial Antiqua',serif}
.tab-menu button:last-child{border-bottom:none}
.tab-menu button.active{background:#ffcc66;color:#111;font-weight:bold}
#navMenu, #tabMenu { display: none; }
#hamburger { display: none; }
@media(max-width:600px){
  .map-title { font-size:28px }
  .tabs, .top-nav { display:none }
  .outer-frame { height:50vh }
  .pin { width:15px; height:15px; }
  .popup { width:160px; max-width:180px; padding:10px 12px }
  .popup img { max-width:150px; max-height:110px }
  .popup h3 { font-size:14px }
  .popup p { font-size:12px }
  .legend { font-size:10px; padding:6px }
  .legend-item img { width:30px; height:30px }
  .map-container { overflow:auto; cursor:grab }
  .map { width:auto; height:auto; min-width:600px; min-height:400px; transform: scale(1.2) translate(-15%, -10%) }
  #hamburger { display:block; position:fixed; top:10px; left:10px; background:#111; color:#fff; border:none; padding:8px 12px; font-size:20px; cursor:pointer; border-radius:4px; z-index:2000 }
  #navMenu { display:none; flex-direction:column; background:#111; border-radius:6px; margin-top:5px; position:fixed; top:50px; left:10px; z-index:2000; overflow:hidden }
  #navMenu a { padding:8px 12px; color:#fff; text-decoration:none; border-bottom:1px solid #333; font-family:'Uncial Antiqua',serif }
  #navMenu a:last-child { border-bottom:none }
  #navMenu a:hover { background:#222; color:#ffcc66 }
  #tabsMenu { display:none; flex-direction:column; background:#111; border-radius:6px; margin-top:5px; position:fixed; top:calc(50px + 40px); left:10px; z-index:2000; overflow:hidden }
  #tabsMenu button { padding:8px 12px; color:#fff; background:#111; border:none; text-align:left; width:150px; cursor:pointer; border-bottom:1px solid #333; font-family:'Uncial Antiqua',serif }
  #tabsMenu button:last-child { border-bottom:none }
  #tabsMenu button.active { background:#ffcc66; color:#111; font-weight:bold }
  .desktop-tabs { display:none }
  .mobile-tabs { display:flex; flex-direction:column; align-items:flex-start }
}
</style>
</head>
<body>

<nav class="top-nav">
  <a href="index.html" class="active">Home</a>
  <a href="story.html">Story</a>
  <a href="tools.html">Tools</a>
  <a href="characters.html">Character Sheet</a>
  <a href="discussions.html">Discussion</a>
  <a href="account.html">My Account</a>
  <a href="login.html" id="authLink">Login</a>
</nav>

<div class="navbar">
  <button id="hamburger">&#9776;</button>
  <div class="navbar-menu" id="navMenu">
    <a href="index.html">Home</a>
    <a href="story.html">Story</a>
    <a href="tools.html">Tools</a>
    <a href="characters.html">Character Sheet</a>
    <a href="discussions.html">Discussion</a>
    <a href="account.html">My Account</a>
    <a href="login.html" id="mobileAuthLink">Login</a>
  </div>
</div>

<div class="map-title">Mount Aetheria</div>

<div class="tabs desktop-tabs">
  <button class="tab-btn active" data-tab="worldmap">World Map</button>
  <button class="tab-btn" data-tab="darkgrasp">Dark Grasp</button>
  <button class="tab-btn" data-tab="reanlegacy">Re'an Legacy</button>
  <button class="tab-btn" data-tab="anothermap">Another Map</button>
</div>

<div class="tabs mobile-tabs">
  <button id="tabHamburger">&#9776; Maps</button>
  <div id="tabMenu" class="tab-menu">
    <button class="tab-btn active" data-tab="worldmap">World Map</button>
    <button class="tab-btn" data-tab="darkgrasp">Dark Grasp</button>
    <button class="tab-btn" data-tab="reanlegacy">Re'an Legacy</button>
    <button class="tab-btn" data-tab="anothermap">Another Map</button>
  </div>
</div>

<div class="outer-frame">
  <div class="tab-content active" id="worldmap">
    <div class="map-container">
      <div class="map"><img src="map.png" alt="World Map"></div>
      <div class="popup"></div>
    </div>
  </div>
  <div class="tab-content" id="darkgrasp">
    <div class="map-container">
      <div class="map"><img src="map.png" alt="Dark Grasp Map"></div>
      <div class="popup"></div>
    </div>
  </div>
  <div class="tab-content" id="reanlegacy">
    <div class="map-container">
      <div class="map"><img src="map.png" alt="Re'an Legacy Map"></div>
      <div class="popup"></div>
    </div>
  </div>
  <div class="tab-content" id="anothermap">
    <div class="map-container">
      <div class="map"><img src="map.png" alt="Another Map"></div>
      <div class="popup"></div>
    </div>
  </div>
</div>

<div class="legend">
  <div class="legend-item"><img src="icons/kingdom.png" alt=""> Kingdom</div>
  <div class="legend-item"><img src="icons/town.png" alt=""> Town</div>
  <div class="legend-item"><img src="icons/landmark.png" alt=""> Landmark</div>
  <div class="legend-item"><img src="icons/event.png" alt=""> Event</div>
  <div class="legend-item"><img src="icons/party.png" alt=""> Party</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBpoi5qvqUehnhcyhfB7d0gtelNUICIthw",
    authDomain: "mount-aetheria.firebaseapp.com",
    projectId: "mount-aetheria",
    storageBucket: "mount-aetheria.firebasestorage.app",
    messagingSenderId: "492855693446",
    appId: "1:492855693446:web:f9948569254a7220c38107",
    measurementId: "G-0PF84KDN7L"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  function setupAuthLink(id) {
    const link = document.getElementById(id);
    if(!link) return;
    onAuthStateChanged(auth, (user) => {
      if (user) {
        link.textContent = "Logout";
        link.href = "#";
        link.onclick = async (e) => {
          e.preventDefault();
          await signOut(auth);
          window.location.reload();
        };
      } else {
        link.textContent = "Login";
        link.href = "login.html";
        link.onclick = null;
      }
    });
  }
  setupAuthLink('authLink');
  setupAuthLink('mobileAuthLink');
</script>

<script src="https://unpkg.com/@panzoom/panzoom/dist/panzoom.min.js"></script>
<script>
// (Previous Map Logic Kept Same)
const pinData = {
  worldmap: [
  {title:"Principality Of Kal'en", desc:"Once under the rule of the Kingdom of Kal'en...", img:"Crest/Kal'en.png", left:"20%", top:"42%", icon:"icons/kingdom.png"},
  {title:"Kingdom of Karph", desc:"The Kingdom of Gold", img:"Crest/Kraph.png", left:"37%", top:"32%", icon:"icons/kingdom.png"},
  {title:"Kingdom of Risha", desc:"Military kingdom.", img:"Crest/Risha.png", left:"36%", top:"53%", icon:"icons/kingdom.png"},
  {title:"Bror Empire", desc:"Revere the Phoenix.", img:"Crest/Bror.png", left:"20%", top:"72%", icon:"icons/kingdom.png"},
  {title:"Kingdom of Eor", desc:"Golden Kingdom.", img:"Crest/Eor.png", left:"61%", top:"63%", icon:"icons/kingdom.png"},
  {title:"You are here", desc:"", img:"", left:"69%", top:"57%", icon:"icons/party.png"}
  ],
  darkgrasp: [{title:"Fortress of Shadows", desc:"Mystery.", img:"Crest/fortress.png", left:"25%", top:"50%", icon:"icons/kingdom.png"}],
  reanlegacy: [{title:"Re'an Capital", desc:"Capital city.", img:"Crest/rean.png", left:"25%", top:"50%", icon:"icons/kingdom.png"}],
  anothermap: [{title:"Northern Outpost", desc:"Strategic outpost.", img:"Crest/outpost.png", left:"40%", top:"60%", icon:"icons/kingdom.png"}]
};

document.querySelectorAll('.tab-content').forEach(tab => {
  const map = tab.querySelector('.map');
  const pins = pinData[tab.id] || [];
  pins.forEach(p => {
    const pin = document.createElement('div');
    pin.className = 'pin';
    pin.style.left = p.left;
    pin.style.top = p.top;
    pin.dataset.title = p.title;
    pin.dataset.description = p.desc;
    pin.dataset.img = p.img;
    pin.innerHTML = `<img src="${p.icon}" alt="">`;
    map.appendChild(pin);
  });
});

if (window.innerWidth <= 600) {
  document.querySelectorAll('.pin').forEach(pin => {
    pin.style.transform = `translate(-50%, -50%)`;
  });
}

document.querySelectorAll('.map').forEach(map => {
  if (!map.panzoom) {
    map.panzoom = Panzoom(map, { maxScale: 5, minScale: 1, contain: 'outside' });
    map.parentElement.addEventListener('wheel', map.panzoom.zoomWithWheel);
  }
});

const tabs = document.querySelectorAll('.tab-btn');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(btn => {
  btn.addEventListener('click', () => {
    tabs.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    contents.forEach(c => c.classList.remove('active'));
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

document.getElementById('hamburger').addEventListener('click', () => {
  const menu = document.getElementById('navMenu');
  menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
});
document.getElementById('tabHamburger').addEventListener('click', () => {
  const menu = document.getElementById('tabMenu');
  menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
});
document.querySelectorAll('#tabMenu .tab-btn').forEach(btn => {
  btn.addEventListener('click', () => document.getElementById('tabMenu').style.display = 'none');
});

document.querySelectorAll('.tab-content').forEach(tab => {
  const popup = tab.querySelector('.popup');
  const container = tab.querySelector('.map-container');
  tab.querySelectorAll('.pin').forEach(pin => {
    pin.addEventListener('click', e => {
      e.stopPropagation();
      const title = pin.dataset.title || '';
      const desc = pin.dataset.description || '';
      const img = pin.dataset.img || '';
      popup.innerHTML = (img ? `<img src="${img}" alt="${title}">` : '') + (title ? `<h3>${title}</h3>` : '') + (desc ? `<p>${desc}</p>` : '');
      
      const rect = pin.getBoundingClientRect();
      const contRect = container.getBoundingClientRect();
      let x = rect.left - contRect.left + container.scrollLeft - popup.offsetWidth/2 + rect.width/2;
      let y = rect.top - contRect.top + container.scrollTop - popup.offsetHeight - 10;
      if (x < 5) x = 5;
      if (x + popup.offsetWidth > container.offsetWidth) x = container.offsetWidth - popup.offsetWidth - 5;
      if (y < 5) y = rect.bottom - contRect.top + container.scrollTop + 10;
      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
      popup.style.display = 'block';
    });
  });
});
document.addEventListener('click', e => {
  if (!e.target.closest('.pin')) {
    document.querySelectorAll('.popup').forEach(p => p.style.display = 'none');
  }
});
</script>
</body>
</html>